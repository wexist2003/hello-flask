<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>Админка</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
    <h1>Админка</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2>Список пользователей</h2>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Код</th>
                <th>Ссылка на профиль</th>
                <th>Рейтинг</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    <td>{{ user[0] }}</td> <td>{{ user[1] }}</td> <td>{{ user[2] }}</td> <td>
                        <a href="{{ request.host_url }}user/{{ user[2] }}" target="_blank">{{ request.host_url }}user/{{ user[2] }}</a>
                    </td>
                    <td>{{ user[3] }}</td> <td>
                        <form action="{{ url_for('delete_user', user_id=user[0]) }}" method="post" style="display: inline-block; margin-right: 5px;">
                            <button class="btn btn-danger btn-sm" type="submit" onclick="return confirm('Вы уверены, что хотите удалить пользователя {{ user[1] }}?');">Удалить</button>
                        </form>
                        </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6">Пользователи еще не добавлены.</td> </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Открыть карточки и подсчитать очки</h2>
    <form action="{{ url_for('open_cards') }}" method="post">
         <button class="btn btn-success" type="submit">Подсчитать очки</button>
    </form>

    <h2>Список изображений</h2>
    <table class="table table-bordered">
         <thead>
            <tr>
                <th>Подкаталог</th>
                <th>Изображение</th>
                <th>Статус</th>
                <th>Превью</th>
            </tr>
        </thead>
        <tbody>
            {% for subfolder, image_name, display_status, img_id in images %}
                 <tr>
                    <td>{{ subfolder }}</td>
                    <td>{{ image_name }}</td>
                    <td>{{ display_status }}</td>
                    <td>
                        <img src="{{ url_for('static', filename='images/' + subfolder + '/' + image_name) }}" alt="img" style="max-width: 100px;">
                    </td>
                </tr>
             {% else %}
                 <tr><td colspan="4">Нет изображений в базе данных.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
