<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Страница игрока - {{ user_data_for_init.name if user_data_for_init else 'Игрок' }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* ... существующие стили ... */
        :root {
            --standard-font-size: 1.1rem;
            --standard-font-size-mobile: 1.1rem;
            --standard-font-size-mobile-small: 1rem;
            --flash-message-font-size: 1rem;
            --header-unified-font-size: 1.5rem;
            --header-unified-font-size-mobile: 1.3rem;

            --my-card-highlight-color: #28a745; /* Зеленый для своей карточки */
            --my-card-highlight-shadow: rgba(40, 167, 69, 0.5);

            /* --- ДОБАВЛЕНО: Переменные для синего цвета рамки Ведущего --- */
            --leader-card-highlight-color: #007bff; /* Синий для карточки Ведущего */
            --leader-card-highlight-shadow: rgba(0, 123, 255, 0.5);

            /* Новые переменные для темной темы */
            --background-color: #f8f9fa; /* Светлый фон */
            --text-color: #343a40; /* Темный текст */
            --text-color-secondary: #6c757d; /* Вторичный темный текст */
            --card-bg-color: #ffffff; /* Светлый фон карточек */
            --border-color: #dee2e6; /* Светлые границы */
            --input-bg-color: #ffffff;
            --input-border-color: #ced4da;
            --button-bg-color: #007bff;
            --button-text-color: #ffffff;
        }

        body.dark-theme {
            --background-color: #343a40; /* Темный фон */
            --text-color: #f8f9fa; /* Светлый текст */
            --text-color-secondary: #adb5bd; /* Вторичный светлый текст */
            --card-bg-color: #495057; /* Темный фон карточек */
            --border-color: #6c757d; /* Темные границы */
            --input-bg-color: #6c757d;
            --input-border-color: #495057;
            --button-bg-color: #0056b3;
            --button-text-color: #ffffff;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
        }

        .container {
            max-width: 1200px;
        }

        .header-unified {
            font-size: var(--header-unified-font-size);
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
            transition: color 0.3s ease-in-out;
        }

        .form-label {
            color: var(--text-color);
        }

        .form-control {
            background-color: var(--input-bg-color);
            color: var(--text-color);
            border-color: var(--input-border-color);
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .btn {
            background-color: var(--button-bg-color);
            color: var(--button-text-color);
            border-color: var(--button-bg-color);
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .btn:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        .alert {
            font-size: var(--flash-message-font-size);
        }

        .player-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: var(--card-bg-color);
            transition: border-color 0.3s ease-in-out;
        }
        .player-card.is-active {
            border-color: var(--my-card-highlight-color);
            box-shadow: 0 0 10px var(--my-card-highlight-shadow);
        }
        .player-card.is-leader {
            border-color: var(--leader-card-highlight-color);
            box-shadow: 0 0 10px var(--leader-card-highlight-shadow);
        }
        .player-card-image {
            width: 100%;
            height: auto;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer; /* Делаем изображение кликабельным для модального окна */
        }
        .player-card-body h5 {
            color: var(--text-color);
        }
        .player-card-body p {
            color: var(--text-color-secondary);
        }
        .btn-game-action {
            width: 100%;
            margin-top: 5px;
        }
        .text-strike {
            text-decoration: line-through;
        }
        .game-board-image-container {
            border: 2px solid transparent; /* Изначально без рамки */
            transition: border-color 0.3s ease-in-out;
        }
        .game-board-image-container.active-guess {
            border-color: yellow; /* Желтая рамка для активного угадывания */
        }
        .game-board-image-container.guessed {
            border-color: green; /* Зеленая рамка для угаданного */
        }
        .game-board-image-container.placed {
            border-color: blue; /* Синяя рамка для размещенного */
        }
        .game-board-image-container.incorrect-guess {
            border-color: red; /* Красная рамка для неверного угадывания */
        }
        .image-container {
            position: relative;
            display: inline-block;
        }
        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Темный фон */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            opacity: 0; /* Скрыто по умолчанию */
            transition: opacity 0.3s ease;
            pointer-events: none; /* Чтобы не мешать кликам */
        }
        .image-container.dimmed .image-overlay {
            opacity: 1; /* Показываем при затемнении */
        }
        /* Стили для модального окна */
        .modal-body-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: auto;
        }
        .modal-xl {
            max-width: 90%;
        }
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .theme-toggle-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            color: var(--text-color);
            transition: color 0.3s ease-in-out;
        }
        .theme-toggle-button:hover {
            color: var(--button-bg-color);
        }
        .theme-toggle-button .icon {
            display: none;
        }
        body.dark-theme .theme-toggle-button #icon-sun {
            display: inline-block;
        }
        body:not(.dark-theme) .theme-toggle-button #icon-moon {
            display: inline-block;
        }

        @media (max-width: 768px) {
            .header-unified {
                font-size: var(--header-unified-font-size-mobile);
            }
            body {
                font-size: var(--standard-font-size-mobile);
            }
            .alert {
                font-size: var(--flash-message-font-size);
            }
        }
        @media (max-width: 576px) {
            body {
                font-size: var(--standard-font-size-mobile-small);
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Страница игрока: <span id="current-user-name">{{ user_data_for_init.name if user_data_for_init else 'Загрузка...' }}</span></h1>
        <p>Ваш код игрока: <strong id="current-user-code">{{ user_data_for_init.code if user_data_for_init else 'Загрузка...' }}</strong></p>
        <p>Ваш рейтинг: <strong id="current-user-rating">{{ user_data_for_init.rating if user_data_for_init else 'Загрузка...' }}</strong></p>

        <div id="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <div class="row">
            <div class="col-md-4">
                <h2>Игроки (<span id="active-users-count">0</span>)</h2>
                <div id="players-list">
                    {% if initial_game_state and initial_game_state.users %}
                        {% for user in initial_game_state.users %}
                            <div class="player-card {{ 'is-active' if user.code == user_data_for_init.code else '' }} {{ 'is-leader' if user.is_leader else '' }}" id="player-card-{{ user.code }}">
                                <div class="player-card-body">
                                    <h5 class="card-title">{{ user.name }} ({{ user.rating }})</h5>
                                    <p class="card-text">
                                        Статус: <span class="badge badge-{{ 'success' if user.status == 'active' else 'secondary' }}">{{ user.status }}</span>
                                        <br>
                                        На доске: <span class="badge badge-info">{{ user.current_position }}</span>
                                        <br>
                                        Последний бросок: <span class="badge badge-primary">{{ user.last_roll if user.last_roll is not none else 'N/A' }}</span>
                                        <br>
                                        Угаданные пользователи: <span class="badge badge-success">{{ user.guesses_made|length }}</span>
                                        <br>
                                        Размещено на доске: <span class="badge badge-success">{{ user.placements_made|length }}</span>
                                        <br>
                                        В игре: <span class="badge badge-{{ 'success' if user.is_in_game else 'secondary' }}">{{ 'Да' if user.is_in_game else 'Нет' }}</span>
                                    </p>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>Нет активных игроков.</p>
                    {% endif %}
                </div>
            </div>

            <div class="col-md-8">
                <h2>Игровое поле</h2>
                <div id="game-board" class="row">
                    {% if initial_game_state and initial_game_state.board_images %}
                        {% for img_data in initial_game_state.board_images %}
                            <div class="col-3 mb-3">
                                <div class="image-container {{ 'dimmed' if img_data.guessed_by or img_data.placed_by else '' }}">
                                    <img src="{{ url_for('static', filename='pole/' + img_data.filename) }}"
                                         class="img-fluid game-board-image player-card-image"
                                         alt="Изображение игрового поля {{ img_data.image_id }}"
                                         data-image-id="{{ img_data.image_id }}"
                                         data-toggle="modal" data-target="#imageModal">
                                    {% if img_data.guessed_by %}
                                        <div class="image-overlay guessed-overlay">
                                            Угадано: <span id="guessed-by-{{ img_data.image_id }}">{{ initial_game_state.users_by_code[img_data.guessed_by].name if initial_game_state.users_by_code[img_data.guessed_by] else 'Неизвестно' }}</span>
                                        </div>
                                    {% elif img_data.placed_by %}
                                        <div class="image-overlay placed-overlay">
                                            Размещено: <span id="placed-by-{{ img_data.image_id }}">{{ initial_game_state.users_by_code[img_data.placed_by].name if initial_game_state.users_by_code[img_data.placed_by] else 'Неизвестно' }}</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="mt-2 text-center">
                                    <p>Позиция: <strong>{{ img_data.board_position }}</strong></p>
                                    <div class="dropdown">
                                        <button class="btn btn-primary dropdown-toggle btn-game-action" type="button" id="guessDropdown-{{ img_data.image_id }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Угадать
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="guessDropdown-{{ img_data.image_id }}">
                                            {% if initial_game_state and initial_game_state.users %}
                                                {% for user_to_guess in initial_game_state.users %}
                                                    {% if user_to_guess.code != user_data_for_init.code and user_to_guess.status == 'active' %}
                                                        <a class="dropdown-item guess-action" href="#" data-image-id="{{ img_data.image_id }}" data-target-user-code="{{ user_to_guess.code }}">
                                                            {{ user_to_guess.name }}
                                                        </a>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="dropdown mt-2">
                                        <button class="btn btn-secondary dropdown-toggle btn-game-action" type="button" id="placeDropdown-{{ img_data.image_id }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Разместить
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="placeDropdown-{{ img_data.image_id }}">
                                            {% if initial_game_state and initial_game_state.users %}
                                                {% for user_to_place in initial_game_state.users %}
                                                    {% if user_to_place.code == user_data_for_init.code and user_to_place.status == 'active' %}
                                                        <a class="dropdown-item place-action" href="#" data-image-id="{{ img_data.image_id }}" data-target-user-code="{{ user_to_place.code }}">
                                                            Разместить свою карточку
                                                        </a>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>Игровое поле не инициализировано.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">Просмотр изображения</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <img src="" class="modal-body-image" id="modalImage" alt="Увеличенное изображение">
                </div>
            </div>
        </div>
    </div>

    <div class="theme-toggle">
        <button class="theme-toggle-button" id="theme-toggle-icon-button">
            <i class="fas fa-moon icon" id="icon-moon"></i>
            <i class="fas fa-sun icon" id="icon-sun"></i>
        </button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <script>
        const socket = io();
        const userCode = "{{ user_data_for_init.code }}"; // Получаем код текущего пользователя из Jinja2

        // Функция для обновления состояния игрока на UI
        function updatePlayerUI(playerData) {
            const playerCard = document.getElementById(`player-card-${playerData.code}`);
            if (playerCard) {
                playerCard.querySelector('.card-title').innerText = `${playerData.name} (${playerData.rating})`;
                playerCard.querySelector('.badge-success:nth-of-type(1)').innerText = playerData.status; // Статус
                playerCard.querySelector('.badge-info').innerText = playerData.current_position; // На доске
                playerCard.querySelector('.badge-primary').innerText = playerData.last_roll !== null ? playerData.last_roll : 'N/A'; // Последний бросок
                playerCard.querySelector('.badge-success:nth-of-type(2)').innerText = playerData.guesses_made.length; // Угаданные
                playerCard.querySelector('.badge-success:nth-of-type(3)').innerText = playerData.placements_made.length; // Размещено

                // Обновление бейджа "В игре"
                const inGameBadge = playerCard.querySelector('.badge.badge-secondary'); // Ищем по классу, который будет у неактивного
                if (inGameBadge) {
                    inGameBadge.classList.remove('badge-success', 'badge-secondary');
                    inGameBadge.classList.add(playerData.is_in_game ? 'badge-success' : 'badge-secondary');
                    inGameBadge.innerText = playerData.is_in_game ? 'Да' : 'Нет';
                }

                // Обновление классов для текущего игрока и лидера
                if (playerData.code === userCode) {
                    playerCard.classList.add('is-active');
                } else {
                    playerCard.classList.remove('is-active');
                }
                if (playerData.is_leader) {
                    playerCard.classList.add('is-leader');
                } else {
                    playerCard.classList.remove('is-leader');
                }
            } else {
                // Если карточки игрока нет, создайте ее (это может произойти, если новый пользователь присоединился)
                const playersList = document.getElementById('players-list');
                const newPlayerCard = document.createElement('div');
                newPlayerCard.classList.add('player-card');
                if (playerData.code === userCode) {
                    newPlayerCard.classList.add('is-active');
                }
                if (playerData.is_leader) {
                    newPlayerCard.classList.add('is-leader');
                }
                newPlayerCard.id = `player-card-${playerData.code}`;
                newPlayerCard.innerHTML = `
                    <div class="player-card-body">
                        <h5 class="card-title">${playerData.name} (${playerData.rating})</h5>
                        <p class="card-text">
                            Статус: <span class="badge badge-${playerData.status === 'active' ? 'success' : 'secondary'}">${playerData.status}</span>
                            <br>
                            На доске: <span class="badge badge-info">${playerData.current_position}</span>
                            <br>
                            Последний бросок: <span class="badge badge-primary">${playerData.last_roll !== null ? playerData.last_roll : 'N/A'}</span>
                            <br>
                            Угаданные пользователи: <span class="badge badge-success">${playerData.guesses_made.length}</span>
                            <br>
                            Размещено на доске: <span class="badge badge-success">${playerData.placements_made.length}</span>
                            <br>
                            В игре: <span class="badge badge-${playerData.is_in_game ? 'success' : 'secondary'}">${playerData.is_in_game ? 'Да' : 'Нет'}</span>
                        </p>
                    </div>
                `;
                playersList.appendChild(newPlayerCard);
            }
        }

        // Функция для обновления состояния игрового поля на UI
        function updateGameBoardUI(boardData, users_by_code) {
            boardData.forEach(img_data => {
                const imageContainer = document.querySelector(`.image-container img[data-image-id="${img_data.image_id}"]`).closest('.image-container');
                if (imageContainer) {
                    imageContainer.classList.remove('dimmed'); // Сначала убираем все затемнения
                    let overlay = imageContainer.querySelector('.image-overlay');
                    if (overlay) {
                        overlay.remove(); // Удаляем существующие наложения
                    }

                    if (img_data.guessed_by) {
                        imageContainer.classList.add('dimmed');
                        overlay = document.createElement('div');
                        overlay.classList.add('image-overlay', 'guessed-overlay');
                        const guessedByName = users_by_code[img_data.guessed_by] ? users_by_code[img_data.guessed_by].name : 'Неизвестно';
                        overlay.innerHTML = `Угадано: <span id="guessed-by-${img_data.image_id}">${guessedByName}</span>`;
                        imageContainer.appendChild(overlay);
                    } else if (img_data.placed_by) {
                        imageContainer.classList.add('dimmed');
                        overlay = document.createElement('div');
                        overlay.classList.add('image-overlay', 'placed-overlay');
                        const placedByName = users_by_code[img_data.placed_by] ? users_by_code[img_data.placed_by].name : 'Неизвестно';
                        overlay.innerHTML = `Размещено: <span id="placed-by-${img_data.image_id}">${placedByName}</span>`;
                        imageContainer.appendChild(overlay);
                    }
                }
            });
        }

        // Обработчик события 'game_update' от сервера
        socket.on('game_update', (data) => {
            console.log('Received game_update:', data);

            // Обновляем список игроков
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = ''; // Очищаем текущий список
            const activeUsersCount = Object.keys(data.users).length;
            document.getElementById('active-users-count').innerText = activeUsersCount;

            // Сортируем пользователей по имени для стабильного порядка
            const sortedUsers = Object.values(data.users).sort((a, b) => a.name.localeCompare(b.name));

            sortedUsers.forEach(user => {
                updatePlayerUI(user);
            });

            // Обновляем игровое поле
            updateGameBoardUI(data.board_images, data.users); // Передаем data.users для получения имен

            // Обновляем информацию о текущем пользователе (если она изменилась, например, рейтинг)
            if (data.users[userCode]) {
                const currentUserData = data.users[userCode];
                document.getElementById('current-user-name').innerText = currentUserData.name;
                document.getElementById('current-user-rating').innerText = currentUserData.rating;
            }

            // Отображение flash-сообщений
            const flashMessagesDiv = document.getElementById('flash-messages');
            flashMessagesDiv.innerHTML = ''; // Очищаем предыдущие сообщения
            if (data.flash_messages && data.flash_messages.length > 0) {
                data.flash_messages.forEach(msg => {
                    const alertDiv = document.createElement('div');
                    alertDiv.classList.add('alert', `alert-${msg.category}`);
                    alertDiv.innerText = msg.message;
                    flashMessagesDiv.appendChild(alertDiv);
                });
            }
        });

        // Обработчики кликов для элементов "Угадать"
        $(document).on('click', '.guess-action', function(e) {
            e.preventDefault(); // Предотвращаем стандартное действие ссылки
            const imageId = $(this).data('image-id');
            const targetUserCode = $(this).data('target-user-code');
            const currentUserCode = $('#current-user-code').text(); // Получаем код текущего пользователя из DOM

            console.log(`Sending guess for image ${imageId} for user ${targetUserCode} by ${currentUserCode}`);

            fetch(`/user/${currentUserCode}/guess/${imageId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ target_user_code: targetUserCode })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Сервер уже отправит game_update через SocketIO
                    console.log('Guess submitted successfully. Waiting for game_update...');
                } else {
                    console.error('Guess failed:', data.message);
                    // Можно показать ошибку пользователю
                    displayFlashMessage(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('Error sending guess:', error);
                displayFlashMessage('Произошла ошибка при отправке угадывания.', 'danger');
            });
        });

        // Обработчики кликов для элементов "Разместить"
        $(document).on('click', '.place-action', function(e) {
            e.preventDefault(); // Предотвращаем стандартное действие ссылки
            const imageId = $(this).data('image-id');
            const targetUserCode = $(this).data('target-user-code'); // Это будет код текущего пользователя
            const currentUserCode = $('#current-user-code').text();

            console.log(`Sending place action for image ${imageId} by ${currentUserCode}`);

            fetch(`/user/${currentUserCode}/place/${imageId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ target_user_code: targetUserCode }) // В данном случае target_user_code = currentUserCode
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Сервер уже отправит game_update через SocketIO
                    console.log('Place action submitted successfully. Waiting for game_update...');
                } else {
                    console.error('Place action failed:', data.message);
                    // Можно показать ошибку пользователю
                    displayFlashMessage(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('Error sending place action:', error);
                displayFlashMessage('Произошла ошибка при отправке размещения.', 'danger');
            });
        });

        // Функция для отображения flash-сообщений
        function displayFlashMessage(message, category) {
            const flashMessagesDiv = document.getElementById('flash-messages');
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('alert', `alert-${category}`);
            alertDiv.innerText = message;
            flashMessagesDiv.appendChild(alertDiv);
            // Можно добавить таймер для автоматического скрытия
            setTimeout(() => {
                alertDiv.remove();
            }, 5000); // Скрыть через 5 секунд
        }


        // Открытие модального окна с изображением
        $('.game-board-image').on('click', function() {
            var imageUrl = $(this).attr('src');
            $('#modalImage').attr('src', imageUrl);
            $('#imageModal').modal('show');
        });

        const themeToggleButton = document.getElementById('theme-toggle-icon-button');
        const iconMoon = document.getElementById('icon-moon');
        const iconSun = document.getElementById('icon-sun');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                if (iconMoon) iconMoon.style.display = 'none';
                if (iconSun) iconSun.style.display = 'inline-block';
            } else {
                document.body.classList.remove('dark-theme');
                if (iconMoon) iconMoon.style.display = 'inline-block';
                if (iconSun) iconSun.style.display = 'none';
            }
        }

        let savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            applyTheme(savedTheme);
        } else {
            applyTheme('light');
        }

        if (themeToggleButton) {
            themeToggleButton.addEventListener('click', () => {
                let newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
        }

        const modalImageElement = document.getElementById('modalImage');
        if (modalImageElement) {
            modalImageElement.addEventListener('click', () => {
                $('#imageModal').modal('hide');
            });
        }
    </script>
</body>
</html>
