<select name="guessed_user_id" class="form-select form-select-sm">
    <option value="">-- Выберите игрока --</option>
    {% for user in all_users %}
        {% if user[0] != g.user_id %}
            <option value="{{ user[0] }}" data-user-id="{{ user[0] }}">{{ user[1] }}</option>
        {% endif %}
    {% endfor %}
</select>
<button type="submit" class="btn btn-primary btn-sm mt-2 guess-button" data-image-id="{{ table_image.id }}">Угадать</button>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const guessButtons = document.querySelectorAll('.guess-button');

        guessButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent form submission for now

                const imageId = this.dataset.imageId;
                const selectElement = this.previousElementSibling; // Get the select element
                const selectedUserId = selectElement.value;
                const selectedUserName = selectElement.options[selectElement.selectedIndex].text;

                if (selectedUserId) {
                    // Disable the selected option in all select elements
                    guessButtons.forEach(otherButton => {
                        if (otherButton.dataset.imageId !== imageId) {
                            const otherSelectElement = otherButton.previousElementSibling;
                            for (let i = 0; i < otherSelectElement.options.length; i++) {
                                if (otherSelectElement.options[i].value === selectedUserId) {
                                    otherSelectElement.options[i].disabled = true;
                                }
                            }
                        }
                    });

                    // Optionally, you can submit the form here if needed
                    selectElement.parentElement.submit();
                }
            });
        });
    });
</script>
